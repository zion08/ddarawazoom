<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.mvc.mybatis.ManagerMapper">

	<!-- 등록 돼있는 모든 코치의 정보 -->
	<select id="getAllCoachInfo" resultType="org.mvc.bean.CoachInfoDTO">
		select * from tbl_coach
	</select>

	<!-- 등록 돼있는 모든 코치 수 -->
	<select id="countAllCoach" resultType="Integer">
		select count(*) from tbl_coach
	</select>
	
	<!-- 코치 한 명의 정보 -->
	<select id="coachInfo" resultType="org.mvc.bean.CoachInfoDTO">
		select * from tbl_coach where c_id = #{c_id}
	</select>
	
	<!-- 코치 한 명의 경력 정보 -->
	<select id="coachCareer" resultType="org.mvc.bean.CoachCareerDTO">
		select * from tbl_coach_career where c_id = #{c_id}
	</select>
	
	<!-- 코치가 등록한 강의 정보 -->
	<select id="getCoachClass" resultType="org.mvc.bean.ZoomDTO">
		select * from tbl_coachClass where c_id = #{c_id}
	</select>
	
	<!-- 코치 강의 삭제 -->
	<update id="deleteClass">
		update tbl_coachClass set
			status = '삭제'
		where num = #{num}
	</update>
	
	<!-- 코치 강의 복구 -->
	<update id="restoreClass">
		update tbl_coachClass set
			status = '등록'
		where num = #{num}
	</update>
	
	<!-- 코치 상태 변경 -->
	<update id="changeStatus">
		update tbl_coach set
			c_status = #{c_status}
		where c_id = #{c_id}
	</update>

	<!-- 전체 멤버 수 -->	
	<select id="countAllUser" resultType="Integer">
		select count(*) from tbl_user where status != '탈퇴'
	</select>
	
	<!-- 멤버 한 명의 정보 -->
	<select id="userInfo" resultType="org.mvc.bean.UserInfoDTO">
		select * from tbl_user where id = #{id}
	</select>
	
	<!-- 비밀번호 변경 -->
	<update id="updateUserPw">
		<![CDATA[
			update tbl_user set pw = #{pw}
				where id = #{id}
		]]>
	</update>
	
	<!-- 멤버 탈퇴 -->
	<update id="userDelete">
		update tbl_user set
			status = '탈퇴'
		where id = #{id}
	</update>
	
	<!-- 일반 가입 멤버 리스트 -->
	<select id="getUserInfo" resultType="org.mvc.bean.UserInfoDTO">
		<![CDATA[
			select id from tbl_user
				where id not like'%kakaoLogin%'  and id not like '%naverLogin%' and status != '탈퇴'
		]]>
	</select>
	
	<!-- 일반 가입 멤버 수 -->
	<select id="userCount" resultType="Integer">
		select count(*) from tbl_user
			where id not like'%kakaoLogin%'  and id not like '%naverLogin%' and status != '탈퇴'
	</select>
	
	<!-- 오늘의 신규 가입자 리스트 -->
	<select id="newUser" resultType="org.mvc.bean.UserInfoDTO">
		<![CDATA[
			select * from tbl_user
				where TO_DATE(regdate, 'yyyy/mm/dd') = TO_DATE(sysdate, 'yyyy/mm/dd') and status != '탈퇴'
		]]>
	</select>
	
	<!-- 신규 가입자 수 -->
	<select id="newUserCount" resultType="Integer">
		<![CDATA[
			select count(*) from tbl_user
				where TO_DATE(regdate, 'yyyy/mm/dd') = TO_DATE(sysdate, 'yyyy/mm/dd') and status != '탈퇴'
		]]>
	</select>
	
	<!-- 탈퇴 멤버 리스트 -->
	<select id="getDeleteUser" resultType="org.mvc.bean.UserInfoDTO">
		select * from tbl_user
			where status = '탈퇴'
	</select>
	
	<!-- 탈퇴 멤버 수 -->
	<select id="getDeleteUserCount" resultType="Integer">
		select count(*) from tbl_user
			where status = '탈퇴'
  </select>

	<!-- 카카오톡 회원가입 멤버 리스트 -->
	<select id="getKakaoUser" resultType="org.mvc.bean.UserInfoDTO">
		<![CDATA[
			select id from tbl_user where id like '%kakaoLogin%' and status != '탈퇴'
		]]>
	</select>
	
	<!-- 카카오톡 회원가입 멤버 수 -->
	<select id="kakaoUserCount" resultType="Integer">
		<![CDATA[
			select count(*) from tbl_user where id like '%kakaoLogin%' and status != '탈퇴'
		]]>
	</select>
		
	<!-- 네이버 회원가입 멤버 리스트 -->
	<select id="getNaverUser" resultType="org.mvc.bean.UserInfoDTO">
		<![CDATA[
			select id from tbl_user where id like '%naverLogin%' and status != '탈퇴'
		]]>
	</select>
	
	<!-- 네이버 회원가입 멤버 수 -->
	<select id="naverUserCount" resultType="Integer">
		<![CDATA[
			select count(*) from tbl_user where id like '%naverLogin%' and status != '탈퇴'
		]]>
	</select>
	
	<!-- 멤버 검색 리스트-->
	<select id="searchUserList" resultType="org.mvc.bean.UserInfoDTO">
		<![CDATA[
			select * from (
				select id, pw, email, regdate, img, status, nick, name, gender, birth, tel, temp_pw, rownum r from(
					select * from tbl_user  where ${category} like '%'||#{input}||'%' order by id desc))
			where r >= #{startRow} and r <= #{endRow}
		]]>
	</select>
	
	<!-- 검색 결과 수 -->
	<select id="searchCount" resultType="int">
		select count(*) from tbl_user where ${category} like '%'||#{input}||'%'
	</select>

	<!-- 관리자 강의 삭제 -->
	<delete id="zoomClassDelete">
		delete from tbl_coachclass where num = #{num} 
	</delete> 
	
	<select id="zoomSearchCount" resultType="int">
		select count(*) from tbl_coachclass where status = '등록' and ${sort} like '%'||#{search}||'%'
	</select>
	
	<select id="zoomSearchList" resultType="org.mvc.bean.ZoomDTO">
	<![CDATA[
		select * from (
			select num, c_id, title, intro, type, goal, tool, frequency, price, img, count, status, c_nick, rownum r from (
				select * from tbl_coachclass where ${sort} like '%'||#{search}||'%' order by num desc))
		where r >= #{startRow} and r <= #{endRow} and status = '등록'
	]]>
	</select>
</mapper>